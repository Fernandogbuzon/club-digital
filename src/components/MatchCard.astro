---
interface Props {
  partido: {
    id: string;
    categoria: string;
    local: string;
    visitante: string;
    puntos_local: number | null;
    puntos_visitante: number | null;
    fecha: string;
    hora: string | null;
    pabellon: string;
    es_resultado: boolean;
  };
  compact?: boolean;
}

const { partido, compact = false } = Astro.props;

// Determinar si ADESA 80 es local o visitante
const esLocal = partido.local.includes('ADESA 80');
const esVisitante = partido.visitante.includes('ADESA 80');

// Determinar ganador
const adesaGano = partido.es_resultado && (
  (esLocal && partido.puntos_local! > partido.puntos_visitante!) ||
  (esVisitante && partido.puntos_visitante! > partido.puntos_local!)
);

const adesaPerdio = partido.es_resultado && !adesaGano;

// Generar enlace a Google Maps
const mapsUrl = `https://www.google.com/maps/search/${encodeURIComponent(partido.pabellon)}`;
---

<div 
  class={`match-card bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 hover:-translate-y-1 overflow-hidden ${compact ? 'p-4' : 'p-6'}`}
  data-categoria={partido.categoria}
  data-tipo={esLocal ? 'local' : 'visitante'}
>
  <!-- Header: Categoría -->
  <div class="flex items-center justify-between mb-4">
    <span class="text-xs font-bold text-adesa-green uppercase tracking-wide bg-green-50 px-3 py-1 rounded-full">
      {partido.categoria}
    </span>
    {partido.es_resultado && adesaGano && (
      <span class="text-xs font-bold text-adesa-green uppercase tracking-wide bg-green-100 px-3 py-1 rounded-full">
        ✓ Victoria
      </span>
    )}
    {partido.es_resultado && adesaPerdio && (
      <span class="text-xs font-bold text-gray-500 uppercase tracking-wide bg-gray-100 px-3 py-1 rounded-full">
        Derrota
      </span>
    )}
  </div>

  <!-- Body: Equipos y Marcador/Fecha -->
  <div class="space-y-3 mb-4">
    {partido.es_resultado ? (
      <!-- Partido con resultado -->
      <div class="space-y-2">
        <div class="flex items-center justify-between">
          <span class={`font-semibold text-gray-900 ${esLocal ? 'text-adesa-dark' : ''}`}>
            {partido.local}
          </span>
          <span class={`text-3xl font-bold ${partido.puntos_local! > partido.puntos_visitante! ? 'text-adesa-green' : 'text-gray-400'}`}>
            {partido.puntos_local}
          </span>
        </div>
        
        <div class="border-t border-gray-200 pt-2"></div>
        
        <div class="flex items-center justify-between">
          <span class={`font-semibold text-gray-900 ${esVisitante ? 'text-adesa-dark' : ''}`}>
            {partido.visitante}
          </span>
          <span class={`text-3xl font-bold ${partido.puntos_visitante! > partido.puntos_local! ? 'text-adesa-green' : 'text-gray-400'}`}>
            {partido.puntos_visitante}
          </span>
        </div>
      </div>
    ) : (
      <!-- Partido sin resultado (próximo) -->
      <div class="space-y-3">
        <div class="text-center py-2">
          <span class={`block text-lg font-bold ${esLocal ? 'text-adesa-dark' : 'text-gray-900'}`}>
            {partido.local}
          </span>
        </div>
        
        <div class="flex items-center justify-center">
          <span class="text-sm font-semibold text-gray-400 bg-gray-100 px-4 py-1 rounded-full">VS</span>
        </div>
        
        <div class="text-center py-2">
          <span class={`block text-lg font-bold ${esVisitante ? 'text-adesa-dark' : 'text-gray-900'}`}>
            {partido.visitante}
          </span>
        </div>
      </div>
    )}
  </div>

  <!-- Footer: Info del partido -->
  <div class="border-t border-gray-100 pt-4 space-y-2">
    <div class="flex items-center text-sm text-gray-600">
      <svg class="w-4 h-4 text-adesa-green mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
      <span class="font-medium text-gray-900">{partido.fecha}</span>
      {partido.hora && (
        <>
          <span class="mx-2 text-gray-400">·</span>
          <span class="font-bold text-adesa-green">{partido.hora}</span>
        </>
      )}
    </div>

    <a 
      href={mapsUrl} 
      target="_blank" 
      rel="noopener noreferrer"
      class="flex items-center text-sm text-gray-600 hover:text-adesa-green transition-colors group"
    >
      <svg class="w-4 h-4 text-adesa-green mr-2 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <span class="truncate">{partido.pabellon}</span>
    </a>
  </div>
</div>

<style>
  .match-card {
    min-height: 280px;
    display: flex;
    flex-direction: column;
  }
</style>
